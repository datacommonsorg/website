# Golden Curation

This folder contains resources and scripts for curating the goldens for nl
detection evals. These are for auto-curating the goldens that then need to go
through manual checks.

## Generate Vars

This auto-curates a list of variable dcids (including all the variables in the
Data Commons knowledge graph) that match a given query.

### Prerequisites

1. In your input folder, you need to have your CSV files with the following columns (there can be multiple rows for the same query if there is disagreement on what the variable string for the query is)
    - query_num: This is a unique number for each query
    - query: This is the full query string
    - var_string: This is the substring of the query that should be used to
    detect the variable in the query
    - groups: These are the groups that the variable in the query could belong to. The variable could belong to multiple groups and these groups should be comma separated.
2. Start a local server with additional embedding indices enabled for all the variable groups
    - you can use the indices defined and enabled here ([catalog.yaml](https://github.com/chejennifer/website/blob/nlGoldensEmbeddings/deploy/nl/catalog.yaml#L96-L155), [autopush.yaml](https://github.com/chejennifer/website/blob/nlGoldensEmbeddings/deploy/helm_charts/envs/autopush.yaml#L65-L74)). These were generated by getting a json of the svg cache following these [instructions](https://g3doc.corp.google.com/datacommons/prophet/tools/README.md#refreshing-statvargroup-cache) and then extracting the dcid and names of the variables to use to [build_embeddings](../../embeddings/README.md#build-embeddings-index).
    - or you can extract variable names and dcids using any other method and use that to [build_embeddings](../../embeddings/README.md#build-embeddings-index).

### Run

```./run.sh vars [--input_folder=] [--output_folder=] [--topic_cache=]```




