kind: ConfigMap
apiVersion: v1
metadata:
  name: ingress-config
  namespace: {{ .Values.namespace.name }}
data:
  rules: |
  {{- range $serviceName, $group := .Values.serviceGroups }}
    {{- if $group }}
      dc-mixer-{{ $serviceName }}:
      {{- range $index, $urlPath := $group.urlPaths }}
        - {{ $urlPath }}
      {{- end }}
    {{- end }}
  {{- end }}

{{- if .Values.website.redis.enabled }}
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: redis-config
  namespace: {{ .Values.namespace.name }}
data:
  redis.json: |-
{{ required "Redis config file is required" .Values.website.redis.configFile | indent 4 }}
{{- end }}


---
kind: ConfigMap
apiVersion: v1
metadata:
  name: blocklist-svg
  namespace: {{ .Values.namespace.name }}
data:
  blocklist_svg.json: {{ toJson .Values.svg.blocklistFile | quote }}


{{- if .Values.cronTesting.enabled }}
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: cron-testing-config
  namespace: {{ .Values.namespace.name }}
data:
  webApiRoot: {{ .Values.cronTesting.webApiRoot | quote }}
  nodejsApiRoot: {{ .Values.cronTesting.nodejsApiRoot | quote }}
  screenshotDomain: {{ .Values.cronTesting.screenshotDomain | quote | default "" }}
  enableSanity: {{ .Values.cronTesting.enableSanity | quote }}
  enableAdversarial: {{ .Values.cronTesting.enableAdversarial | quote }}
{{- end }}