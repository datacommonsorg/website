This helm chart installs the Data Commons web application on a live GKE cluster.

For more on Data Commons, see https://datacommons.org/about.

How to install this chart.

It is assumed that the domain specified already points to the global static ip that is reserved.

1. Make sure that the k8s config is set to the correct cluster.

```
kubectl config current-context
```

2. Paste the template below into a new file called instance-values.yaml.

```
website:
  domains: ["your-website-domain"]
  githash: "your-website-githash"
  ingress:
    annotations:
      kubernetes.io/ingress.global-static-ip-name: "your-external-global-static-ip-name"
  flask:
    secretGCPProjectID: "your-flasks-secret-gcp-project"
  iap:
    clientID: "your-iap-client-id"
    secret: "your-iap-secret"

mixer:
  gcpProjectID: "your-mixer-gcp-project-id"
  githash: "your-mixer-githash"

namespace:
  name: "your-namespace"

serviceAccount:
  annotations: {
    iam.gke.io/gcp-service-account: "your-robot-google-service-account"
  }

kgStoreConfig:
  bigqueryVersion: "your-bigquery-version"
  bigtableImportGroupsVersion: |
    <content-of-bigtable-import-group-version-file>
  storeProjectID: "your-storage-project-gcp-id
```

3. Fill out all the instance specific variables from above.


4. Optional. Run an install in dry-run mode to see if there are no validation errors.

```
helm install \
  -f instance-values.yaml \
  oci://us-docker.pkg.dev/datcom-ci/dev-website-helm-chart/dc-website \
  --version 0.1.0 \
  --dry-run
```

5. Install using helm.

```
helm install \
  -f instance-values.yaml \
  oci://us-docker.pkg.dev/datcom-ci/dev-website-helm-chart/dc-website \
  --version 0.1.0 \
```

** Please expect O(hours) for the managed certificate to provision. **
