{%- extends "custom_dc/health/admin/base.html" -%}

{% set title = 'Admin Configuration Panel - Health Monitoring Organization' %}

{% block head %}
<link href="{{url_for('static', filename='custom_dc/health/css/components/_alert.css')}}" rel="stylesheet">
<link href="{{url_for('static', filename='custom_dc/health/css/pages/_dashboard.css')}}" rel="stylesheet">
{% endblock %}

{% block content %}
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <md-icon-button href="{{ url_for('static.homepage') }}">
        <md-icon>arrow_back</md-icon>
      </md-icon-button>
      <div class="header-title-group">
        <h1 class="header-title">Admin Configuration Panel</h1>
        <p class="header-subtitle">Manage users, data sources, and theme settings for the Health Data Commons</p>
      </div>
    </div>
    <div class="button-group">
      <md-outlined-button href="{{ url_for('static.homepage') }}">
        <md-icon slot="icon">visibility</md-icon>
        Preview Insights
      </md-outlined-button>
      <md-outlined-button onclick="logout()">
        <md-icon slot="icon">logout</md-icon>
        Sign Out
      </md-outlined-button>
    </div>
  </header>

  <!-- Main Container -->
  <main class="container">
    <!-- Snackbar Container - Top Right -->
    <div class="snackbar-container" aria-live="polite" aria-atomic="false">
      <div class="md3-snackbar" id="alertMessage" role="status" aria-live="polite" aria-atomic="false">
        <span id="alertMessageContent" class="md3-snackbar-content"></span>
        <md-icon-button class="md3-snackbar-action" id="alertDissmiss" aria-label="Dismiss message">
          <md-icon>close</md-icon>
        </md-icon-button>
      </div>
    </div>
    <!-- Tab Navigation -->
    <nav class="tabs">
      <a href="#" class="tab active" onclick="switchTab(event, 'data')">
        <md-icon>database</md-icon>
        Data & Files
      </a>
      <a href="#" class="tab" onclick="switchTab(event, 'theme')">
        <md-icon>palette</md-icon>
        Theme Settings
      </a>
    </nav>

    <!-- Data & Files Tab -->
    <div id="data-tab" class="tab-content active">
      <!-- Steps Card -->
      <md-card>
        <h2 class="card-title section-title">Steps to get started</h2>

        <div class="steps-container">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <p class="step-title">Export your health metrics data as CSV from your data source</p>
              <md-text-button href="{{url_for('static', filename='custom_dc/health/data/health_dashboard.csv')}}"
                download="sample_applicant_data.csv">Download sample CSV</md-text-button>
            </div>
          </div>

          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <p class="step-title">Upload your file using the button below</p>
            </div>
          </div>

          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <p class="step-title">View insights and recommended target regions</p>
            </div>
          </div>
        </div>
      </md-card>

      <!-- Health Metrics Data Upload -->
      <md-card>
        <div class="card-header">
          <div class="card-icon-wrapper">
            <md-icon>upload</md-icon>
          </div>
          <div class="card-title-group">
            <h2 class="card-title">Health Metrics Data Upload</h2>
            <p class="card-description">Upload your current applicant data to see health metrics for your regions</p>
          </div>
        </div>

        <md-divider></md-divider>

        <div class="upload-card">
          <h3 class="upload-title">Upload Health Data</h3>
          <p class="upload-meta">Supported format: CSV</p>
          <p class="upload-note">
            Uploaded data powers city health metrics and comparative analytics
          </p>

          <!-- Selected File Display -->
          <div id="selectedFileDisplay" class="selected-file-display">
            <md-icon class="selected-file-icon">description</md-icon>
            <div class="selected-file-info">
              <p class="selected-file-name" id="selectedFileName">filename.csv</p>
              <p class="selected-file-size" id="selectedFileSize">0 KB</p>
            </div>
            <md-icon-button class="remove-file-btn" onclick="removeFile('applicant')">
              <md-icon>close</md-icon>
            </md-icon-button>
          </div>

          <div class="button-group">
            <md-filled-button class="inline-button" onclick="document.getElementById('applicantFileInput').click()">
              <md-icon slot="icon">upload</md-icon>
              Choose File
            </md-filled-button>
            <md-outlined-button class="inline-button" onclick="uploadApplicantFile()">
              <md-icon slot="icon">cloud_upload</md-icon>
              Upload File
            </md-outlined-button>
          </div>
          <input type="file" id="applicantFileInput" accept=".csv" class="hidden"
            onchange="handleFileSelect(event, 'applicant')">
        </div>

        <md-divider class="divider-short"></md-divider>

        <!-- Upload Status -->
        <div class="status-box hidden" id="uploadResponseMessage">
          <div class="status-chips-container">
            <md-filter-chip label="Upload Successful" id="successUploadStatus" class="status-chip-success hidden">
            </md-filter-chip>

            <md-filter-chip label="Upload Failed" id="failedUploadStatus" class="status-chip-error hidden">
            </md-filter-chip>
          </div>

          <div class="status-row">
            <span class="status-label">Upload message:</span>
            <span class="status-value" id="uploadStatusMessage"></span>
          </div>
          <div class="status-row hidden" id="rowsUploaded">
            <span class="status-label">Number of acceptable rows:</span>
            <span class="status-value" id="rowsUploadedsMessage"></span>
          </div>
          <div class="status-row hidden" id="failedRows">
            <span class="status-label">Number of unacceptable rows:</span>
            <span class="status-value" id="failedRowsMessage"></span>
          </div>
          <div class="status-row hidden" id="rowsUploaded">
            <span class="status-label">Rows uploaded:</span>
            <span class="status-value" id="rowsUploadedsMessage"></span>
          </div>
          <div class="status-row hidden" id="failedRows">
            <span class="status-label">Failed rows:</span>
            <span class="status-value" id="failedRowsMessage"></span>
          </div>
          <div class="error-list hidden" id="uploadErrorBlock"></div>
        </div>
      </md-card>
    </div>

    <!-- Theme Settings Tab -->
    <div id="theme-tab" class="tab-content">
      <!-- Branding Section -->
      <md-card>
        <div class="card-header">
          <div class="card-icon-wrapper">
            <md-icon>palette</md-icon>
          </div>
          <div class="card-title-group">
            <h2 class="card-title">Portal Branding</h2>
            <p class="card-description">Customize portal information and appearance for Health Data Commons</p>
          </div>
        </div>

        <md-divider></md-divider>

        <!-- City Name -->
        <div class="form-field">
          <label class="form-label">Main City</label>
          <md-outlined-select id="cityName" label="Select the main city to display on the portal">
            <md-select-option value="Boston, MA" selected>
              <div slot="headline">Boston, MA</div>
            </md-select-option>
            <md-select-option value="Houston, TX">
              <div slot="headline">Houston, TX</div>
            </md-select-option>
            <md-select-option value="Los Angeles, CA">
              <div slot="headline">Los Angeles, CA</div>
            </md-select-option>
            <md-select-option value="San Antonio, TX">
              <div slot="headline">San Antonio, TX</div>
            </md-select-option>
            <md-select-option value="Austin, TX">
              <div slot="headline">Austin, TX</div>
            </md-select-option>
            <md-select-option value="Nashville, TN">
              <div slot="headline">Nashville, TN</div>
            </md-select-option>
            <md-select-option value="San Diego, CA">
              <div slot="headline">San Diego, CA</div>
            </md-select-option>
            <md-select-option value="Sacramento, CA">
              <div slot="headline">Sacramento, CA</div>
            </md-select-option>
          </md-outlined-select>
          <p id="cityNameError" class="field-error hidden">Please select a city</p>
        </div>

        <!-- Organization Name -->
        <div class="form-field">
          <label class="form-label">Organization Name</label>
          <md-outlined-text-field id="domainName" placeholder="Health Data Commons" value="Health Data Commons">
          </md-outlined-text-field>
          <p id="domainNameError" class="field-error hidden">Organization name is required</p>
        </div>

        <!-- Contact Email -->
        <div class="form-field">
          <label class="form-label">Contact Email</label>
          <md-outlined-text-field id="contactEmail" type="email" placeholder="contact@example.com" value="contact@example.com">
          </md-outlined-text-field>
          <p id="contactEmailError" class="field-error hidden">Please enter a valid email address</p>
        </div>

        <!-- Logo Upload -->
        <div class="form-field">
          <label class="form-label">Portal Logo</label>

          <div class="logo-upload-container">
            <!-- Selected Logo Display -->
            <div id="selectedLogoDisplay" class="selected-file-display selected-logo-display">
              <md-icon class="logo-icon">description</md-icon>
              <div class="logo-file-info">
                <p id="selectedLogoName" class="selected-logo-name">
                </p>
              </div>
              <md-icon-button onclick="removeFile('logo')">
                <md-icon class="logo-close-icon">close</md-icon>
              </md-icon-button>
            </div>

            <input type="file" id="logoUpload" accept=".png" onchange="handleFileSelect(event, 'logo')"
              class="hidden" />
            <md-filled-button class="inline-button logo-upload-button" onclick="document.getElementById('logoUpload').click()">
              <md-icon slot="icon">upload</md-icon>
              Choose File
            </md-filled-button>
          </div>

          <p class="field-hint">Recommended size: 200 × 80px • Supports PNG</p>
        </div>
        <input type="hidden" id="logoPresent" value="false" />

        <div class="button-group">
          <md-filled-button class="inline-button" onclick="saveChanges()">
            <md-icon slot="icon">save</md-icon>
            Save Changes
          </md-filled-button>
        </div>
      </md-card>
    </div>
  </main>
{% endblock %}

{% block scripts %}
<script src={{url_for('static', filename='custom_dc/health/js/components/alert.js' )}}></script>
<script type="module" src={{url_for('static', filename='custom_dc/health/js/pages/dashboard.js' )}}></script>
{% endblock %}
